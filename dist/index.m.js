import t from"isomorphic-unfetch";function r(){return r=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},r.apply(this,arguments)}function e(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,n(t,r)}function n(t,r){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},n(t,r)}var o=/*#__PURE__*/function(){function e(t){this.apikey=void 0,this.baseUrl=void 0,this.apikey=t.apiKey,this.baseUrl=t.baseUrl||"https://search.imdbot.workers.dev/"}return e.prototype.invoke=function(e,n,o){try{var i=""+this.baseUrl+e+"?"+n,c=r({headers:{"Content-Type":"application/json","x-api-key":this.apikey}},o);return Promise.resolve(t(i,c)).then(function(t){if(t.ok)return t.json();throw new Error(t.statusText)})}catch(t){return Promise.reject(t)}},e}();function i(t,r){try{var e=t()}catch(t){return r(t)}return e&&e.then?e.then(void 0,r):e}function c(t,r,e){if(!t.s){if(e instanceof s){if(!e.s)return void(e.o=c.bind(null,t,r));1&r&&(r=e.s),e=e.v}if(e&&e.then)return void e.then(c.bind(null,t,r),c.bind(null,t,2));t.s=r,t.v=e;var n=t.o;n&&n(t)}}var u,s=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(r,e){var n=new t,o=this.s;if(o){var i=1&o?r:e;if(i){try{c(n,1,i(this.v))}catch(t){c(n,2,t)}return n}return this}return this.o=function(t){try{var o=t.v;1&t.s?c(n,1,r?r(o):o):e?c(n,1,e(o)):c(n,2,o)}catch(t){c(n,2,t)}},n},t}(),a=/*#__PURE__*/function(t){function r(){return t.apply(this,arguments)||this}e(r,t);var n=r.prototype;return n.search=function(t){try{return Promise.resolve(this.invoke("","q="+t)).then(function(t){var r=t.description;return{ok:t.ok,error_code:t.error_code,movies:null==r?void 0:r.map(function(t){return{title:t["#TITLE"],year:t["#YEAR"],imdbId:t["#IMDB_ID"],rank:t["#RANK"],actors:t["#ACTORS"],aka:t["#AKA"],imdbUrl:t["#IMDB_URL"],imdbIv:t["#IMDB_IV"],imgPoster:t["#IMG_POSTER"],photo_width:t.photo_width,photo_height:t.photo_height}})}})}catch(t){return Promise.reject(t)}},n.getMovieDetails=function(t){try{var r=this;return Promise.resolve(i(function(){return Promise.resolve(r.invoke("","tt="+t)).then(function(r){var e=r.short;return{details:{url:e.url,name:e.name,description:e.description,imageUrl:e.image,review:e.review,genres:e.genre,keywords:e.keywords,actors:e.actor,director:e.director,duration:e.duration,id:t,rating:e.contentRating},error_code:"200",ok:!0}})},function(){return{error_code:"400",ok:!1,details:null}}))}catch(t){return Promise.reject(t)}},n.getRandomMovies=function(t){void 0===t&&(t=10);try{var r=this,e="400";return Promise.resolve(i(function(){var n;function o(){return{ok:!0,movies:l.sort(function(t,r){return t.title-r.title}).slice(0,t),error_code:e}}var i,u,a,h,f,p,v=function(t){for(var r="",e=0;e<5;)r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(52*Math.random())),e+=1;return r.split("")}(),l=[],d=(i=v,u=function(o){return Promise.resolve(r.search(v[o])).then(function(r){r.ok&&(l.push.apply(l,r.movies),l.length>=t&&(e="200",n=1))})},a=function(){return n},p=-1,function t(r){try{for(;++p<i.length&&(!a||!a());)if((r=u(p))&&r.then){if(!((e=r)instanceof s&&1&e.s))return void r.then(t,f||(f=c.bind(null,h=new s,2)));r=r.v}h?c(h,1,r):h=r}catch(t){c(h||(h=new s),2,t)}var e}(),h);return d&&d.then?d.then(o):o()},function(){return{ok:!0,movies:null,error_code:e}}))}catch(t){return Promise.reject(t)}},r}(o),h=/*#__PURE__*/function(t){function r(){return t.apply(this,arguments)||this}return e(r,t),r}(o);u=h,[a].forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(r){Object.defineProperty(u.prototype,r,Object.getOwnPropertyDescriptor(t.prototype,r))})});export{h as default};
