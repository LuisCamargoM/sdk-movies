function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=/*#__PURE__*/t(require("isomorphic-unfetch"));function e(){return e=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},e.apply(this,arguments)}function n(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,o(t,r)}function o(t,r){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},o(t,r)}var i=/*#__PURE__*/function(){function t(t){this.apikey=void 0,this.baseUrl=void 0,this.apikey=t.apiKey,this.baseUrl=t.baseUrl||"https://search.imdbot.workers.dev/"}return t.prototype.invoke=function(t,n,o){try{var i=""+this.baseUrl+t+"?"+n,c=e({headers:{"Content-Type":"application/json","x-api-key":this.apikey}},o);return Promise.resolve(r.default(i,c)).then(function(t){if(t.ok)return t.json();throw new Error(t.statusText)})}catch(t){return Promise.reject(t)}},t}();function c(t,r){try{var e=t()}catch(t){return r(t)}return e&&e.then?e.then(void 0,r):e}function u(t,r,e){if(!t.s){if(e instanceof a){if(!e.s)return void(e.o=u.bind(null,t,r));1&r&&(r=e.s),e=e.v}if(e&&e.then)return void e.then(u.bind(null,t,r),u.bind(null,t,2));t.s=r,t.v=e;var n=t.o;n&&n(t)}}var s,a=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(r,e){var n=new t,o=this.s;if(o){var i=1&o?r:e;if(i){try{u(n,1,i(this.v))}catch(t){u(n,2,t)}return n}return this}return this.o=function(t){try{var o=t.v;1&t.s?u(n,1,r?r(o):o):e?u(n,1,e(o)):u(n,2,o)}catch(t){u(n,2,t)}},n},t}(),h=/*#__PURE__*/function(t){function r(){return t.apply(this,arguments)||this}n(r,t);var e=r.prototype;return e.search=function(t){try{return Promise.resolve(this.invoke("","q="+t)).then(function(t){var r=t.description;return{ok:t.ok,error_code:t.error_code,movies:null==r?void 0:r.map(function(t){return{title:t["#TITLE"],year:t["#YEAR"],imdbId:t["#IMDB_ID"],rank:t["#RANK"],actors:t["#ACTORS"],aka:t["#AKA"],imdbUrl:t["#IMDB_URL"],imdbIv:t["#IMDB_IV"],imgPoster:t["#IMG_POSTER"],photo_width:t.photo_width,photo_height:t.photo_height}})}})}catch(t){return Promise.reject(t)}},e.getMovieDetails=function(t){try{var r=this;return Promise.resolve(c(function(){return Promise.resolve(r.invoke("","tt="+t)).then(function(r){var e=r.short;return{details:{url:e.url,name:e.name,description:e.description,imageUrl:e.image,review:e.review,genres:e.genre,keywords:e.keywords,actors:e.actor,director:e.director,duration:e.duration,id:t,rating:e.contentRating},error_code:"200",ok:!0}})},function(){return{error_code:"400",ok:!1,details:null}}))}catch(t){return Promise.reject(t)}},e.getRandomMovies=function(t){void 0===t&&(t=10);try{var r=this,e="400";return Promise.resolve(c(function(){var n;function o(){return{ok:!0,movies:l.sort(function(t,r){return t.title-r.title}).slice(0,t),error_code:e}}var i,c,s,h,f,p,v=function(t){for(var r="",e=0;e<5;)r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(52*Math.random())),e+=1;return r.split("")}(),l=[],d=(i=v,c=function(o){return Promise.resolve(r.search(v[o])).then(function(r){r.ok&&(l.push.apply(l,r.movies),l.length>=t&&(e="200",n=1))})},s=function(){return n},p=-1,function t(r){try{for(;++p<i.length&&(!s||!s());)if((r=c(p))&&r.then){if(!((e=r)instanceof a&&1&e.s))return void r.then(t,f||(f=u.bind(null,h=new a,2)));r=r.v}h?u(h,1,r):h=r}catch(t){u(h||(h=new a),2,t)}var e}(),h);return d&&d.then?d.then(o):o()},function(){return{ok:!0,movies:null,error_code:e}}))}catch(t){return Promise.reject(t)}},r}(i),f=/*#__PURE__*/function(t){function r(){return t.apply(this,arguments)||this}return n(r,t),r}(i);s=f,[h].forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(r){Object.defineProperty(s.prototype,r,Object.getOwnPropertyDescriptor(t.prototype,r))})}),module.exports=f;
