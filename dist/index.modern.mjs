import t from"isomorphic-unfetch";function e(){return e=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},e.apply(this,arguments)}class r{constructor(t){this.apikey=void 0,this.baseUrl=void 0,this.apikey=t.apiKey,this.baseUrl=t.baseUrl||"https://search.imdbot.workers.dev/"}async invoke(r,o,i){const s=`${this.baseUrl}${r}?${o}`,a=e({headers:{"Content-Type":"application/json","x-api-key":this.apikey}},i),n=await t(s,a);if(n.ok)return n.json();throw new Error(n.statusText)}}class o extends r{}var i;i=o,[class extends r{async search(t){const e=await this.invoke("",`q=${t}`),{description:r,error_code:o,ok:i}=e;return{ok:i,error_code:o,movies:null==r?void 0:r.map(t=>({title:t["#TITLE"],year:t["#YEAR"],imdbId:t["#IMDB_ID"],rank:t["#RANK"],actors:t["#ACTORS"],aka:t["#AKA"],imdbUrl:t["#IMDB_URL"],imdbIv:t["#IMDB_IV"],imgPoster:t["#IMG_POSTER"],photo_width:t.photo_width,photo_height:t.photo_height}))}}async getMovieDetails(t){try{const e=await this.invoke("",`tt=${t}`),{short:r}=e;return{details:{url:r.url,name:r.name,description:r.description,imageUrl:r.image,review:r.review,genres:r.genre,keywords:r.keywords,actors:r.actor,director:r.director,duration:r.duration,id:t,rating:r.contentRating},error_code:"200",ok:!0}}catch(t){return{error_code:"400",ok:!1,details:null}}}async getRandomMovies(t=10){let e="400";try{const r=t=>{let e="",r=0;for(;r<t;)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(52*Math.random())),r+=1;return e.split("")},o=r(5),i=[];for(let r=0;r<o.length;r++){const s=await this.search(o[r]);if(s.ok&&(i.push(...s.movies),i.length>=t)){e="200";break}}return{ok:!0,movies:i.sort((t,e)=>t.title-e.title).slice(0,t),error_code:e}}catch(t){return{ok:!0,movies:null,error_code:e}}}}].forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(e=>{Object.defineProperty(i.prototype,e,Object.getOwnPropertyDescriptor(t.prototype,e))})});export{o as default};
